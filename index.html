<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wallet Connect - BSC</title>
  
  <!-- Web3.js Library -->
  <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
  
  <!-- WalletConnect Provider Library -->
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.6.6/dist/umd/index.min.js"></script>
</head>
<body>
  <button id="connectWalletButton">Connect Wallet</button>
  <p id="walletAddress">Wallet Address: Not Connected</p>
  <p id="walletBalance">BNB Balance: Not Available</p>

  <script type="text/javascript">
    const connectWalletButton = document.getElementById("connectWalletButton");
    const walletAddressDisplay = document.getElementById("walletAddress");
    const walletBalanceDisplay = document.getElementById("walletBalance");
    let web3;

    // Function to connect the wallet using either MetaMask or WalletConnect
    async function connectWallet() {
      // Check if MetaMask (window.ethereum) is available
      if (window.ethereum) {
        try {
          const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
          const walletAddress = accounts[0];
          walletAddressDisplay.textContent = `Wallet Address: ${walletAddress}`;
          console.log("Connected with MetaMask: ", walletAddress);

          // Initialize Web3 with MetaMask provider
          web3 = new Web3(window.ethereum);

          // Fetch and display BNB balance
          await fetchBNBBalance(walletAddress);
        } catch (error) {
          console.error("User rejected MetaMask request");
        }
      } else {
        // If MetaMask is not available, use WalletConnect
        const provider = new WalletConnectProvider({
          rpc: {
            56: "https://bsc-dataseed.binance.org/",  // Mainnet BSC public node
          },
        });

        try {
          await provider.enable();

          // Initialize Web3 with WalletConnect provider
          web3 = new Web3(provider);
          const accounts = await web3.eth.getAccounts();
          const walletAddress = accounts[0];
          walletAddressDisplay.textContent = `Wallet Address: ${walletAddress}`;
          console.log("Connected with WalletConnect: ", walletAddress);

          // Fetch and display BNB balance
          await fetchBNBBalance(walletAddress);
        } catch (error) {
          console.error("WalletConnect failed:", error);
        }
      }
    }

    // Function to fetch and display the BNB balance of the connected wallet
    async function fetchBNBBalance(walletAddress) {
      try {
        const balanceWei = await web3.eth.getBalance(walletAddress);  // Fetch balance in Wei
        const balanceBNB = web3.utils.fromWei(balanceWei, 'ether');  // Convert Wei to BNB
        walletBalanceDisplay.textContent = `BNB Balance: ${balanceBNB} BNB`;
        console.log(`BNB Balance: ${balanceBNB} BNB`);
      } catch (error) {
        console.error("Failed to fetch BNB balance:", error);
        walletBalanceDisplay.textContent = `BNB Balance: Error fetching balance`;
      }
    }

    // Add click event listener to connect wallet button
    connectWalletButton.addEventListener('click', connectWallet);
  </script>
</body>
</html>
